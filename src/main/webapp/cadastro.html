<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Gerenciamento de Usuários</title>
    <!-- Adicione os links para os arquivos CSS do Bootstrap -->
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css">
    <!-- Estilos CSS adicionais podem ser incluídos aqui -->
    <style>
        /* Estilos adicionais */
        .container {
            margin-top: 50px;
        }
    </style>
</head>
<body>
<div class="container">
    <h1>Gerenciamento de Usuários</h1>
    <!-- Botão para abrir o modal de adicionar usuário -->
    <button id="btnAdd" class="btn btn-primary" data-toggle="modal" data-target="#modalAdicionarUsuario">Adicionar Usuário</button>
    <hr>
    <div id="userDetails">
        <!-- Detalhes do usuário serão exibidos aqui -->
    </div>
</div>

<!-- Modal de adicionar usuário -->
<div class="modal fade" id="modalAdicionarUsuario" tabindex="-1" role="dialog" aria-labelledby="modalAdicionarUsuarioLabel" aria-hidden="true">
    <div class="modal-dialog" role="document">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="modalAdicionarUsuarioLabel">Adicionar Novo Usuário</h5>
                <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                    <span aria-hidden="true">&times;</span>
                </button>
            </div>
            <div class="modal-body">
                <!-- Formulário para adicionar um novo usuário -->
                <form id="formAdicionarUsuario">
                    <div class="form-group">
                        <label for="cpf">CPF:</label>
                        <input type="text" class="form-control" id="cpf" name="cpf" required>
                    </div>
                    <div class="form-group">
                        <label for="nomeCompleto">Nome Completo:</label>
                        <input type="text" class="form-control" id="nomeCompleto" name="nomeCompleto" required>
                    </div>
                    <div class="form-group">
                        <label for="email">Email:</label>
                        <input type="email" class="form-control" id="email" name="email" required>
                    </div>
                    <div class="form-group">
                        <label for="dataNascimento">Data de Nascimento:</label>
                        <input type="date" class="form-control" id="dataNascimento" name="dataNascimento" required>
                    </div>
                    <button type="submit" class="btn btn-primary">Adicionar</button>
                </form>
            </div>
        </div>
    </div>
</div>

<!-- Adicione o link para o script do Bootstrap JavaScript -->
<script src="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/js/bootstrap.min.js"></script>
<script>
    // Lógica JavaScript para enviar dados do formulário e adicionar um novo usuário
    document.getElementById('formAdicionarUsuario').addEventListener('submit', async (event) => {
        event.preventDefault();

        const formData = new FormData(event.target);
        const usuarioDAO = Object.fromEntries(formData.entries());

        try {
            // Enviar os dados do usuário para o backend
            const response = await fetch('/usuarioDAOS/adicionar', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json'
                },
                body: JSON.stringify(usuarioDAO)
            });

            if (response.ok) {
                // Atualizar a tabela de usuários após a adição bem-sucedida
                loadUserDetails();
                // Fechar o modal
                $('#modalAdicionarUsuario').modal('hide');
                // Limpar o formulário
                event.target.reset();
            } else {
                console.error('Falha ao adicionar usuário:', response.statusText);
            }
        } catch (error) {
            console.error('Erro ao adicionar usuário:', error);
        }
    });

    // Função para carregar os detalhes do usuário
    function loadUserDetails() {
        fetch('/getUserDetails')
            .then(response => response.json())
            .then(data => {
                // Limpar o conteúdo atual
                document.getElementById('userDetails').innerHTML = '';

                // Criar elementos HTML para exibir os detalhes do usuário
                const userDetailsDiv = document.getElementById('userDetails');
                const userDetailsTable = document.createElement('table');
                userDetailsTable.classList.add('table');
                userDetailsTable.classList.add('table-striped');

                // Cabeçalho da tabela
                const tableHeader = document.createElement('thead');
                tableHeader.innerHTML = `
                        <tr>
                            <th>ID</th>
                            <th>CPF</th>
                            <th>Nome Completo</th>
                            <th>Email</th>
                            <th>Data de Nascimento</th>
                        </tr>
                    `;
                userDetailsTable.appendChild(tableHeader);

                // Corpo da tabela
                const tableBody = document.createElement('tbody');
                data.forEach(user => {
                    const row = document.createElement('tr');
                    row.innerHTML = `
                            <td>${user.id}</td>
                            <td>${user.cpf}</td>
                            <td>${user.nomeCompleto}</td>
                            <td>${user.email}</td>
                            <td>${user.dataNascimento}</td>
                        `;
                    tableBody.appendChild(row);
                });
                userDetailsTable.appendChild(tableBody);

                userDetailsDiv.appendChild(userDetailsTable);
            })
            .catch(error => console.error('Erro ao carregar os detalhes do usuário:', error));
    }

    // Carregar os detalhes do usuário quando a página carregar
    document.addEventListener('DOMContentLoaded', () => {
        loadUserDetails();
    });
</script>
</body>
</html>
